/*!
 *  dcplot.js 0.4.0
 *  http://att.github.io/dcplot.js/
 *  Copyright (c) 2012-2013 AT&T Intellectual Property
 *
 *  Permission is hereby granted, free of charge, to any person obtaining a copy
 *  of this software and associated documentation files (the "Software"), to deal
 *  in the Software without restriction, including without limitation the rights
 *  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 *  copies of the Software, and to permit persons to whom the Software is
 *  furnished to do so, subject to the following conditions:
 *
 *  The above copyright notice and this permission notice shall be included in
 *  all copies or substantial portions of the Software.
 *
 *  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 *  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 *  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 *  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 *  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 *  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 *  THE SOFTWARE.
 */

!function(){function a(a,b){"use strict";function c(a){return"supported"===a||"concrete"===a||"parents"===a}function d(a,b,c){if(!(b in a))throw"unknown chart type "+b;var e=Array.prototype.slice.call(arguments,3),f=a[b];if("parents"in f)for(var g=0;g<f.parents.length;++g)d.apply(null,[a,f.parents[g],c].concat(e));f[c]&&f[c].apply(f,e)}function e(f,g,h,i){function j(a,b,d,e,f){function g(a,b){var d=i[b];if(!d.supported)throw"chart type "+b+" not supported";var e=d.attributes;for(var f in e)c(f)||_.has(e[f],"default")&&void 0===a[f]&&(a[f]=e[f]["default"]);if("parents"in d)for(var h=0;h<d.parents.length;++h)g(a,d.parents[h])}g(d,d.type)}function k(a,b,c,e,g){var h=[];if(d(i,c.type,"infer",a,b,f,c,e,g,h),h.length)throw h}function l(a,b,d){function e(a,b,d,f){var g=i[b];if(!g.supported)throw'type "'+b+'" not supported';var h=g.attributes;if("parents"in g)for(var j=0;j<g.parents.length;++j)e(a,g.parents[j],d,f);for(var k in h)c(k)||(h[k].required&&void 0===a[k]&&d.push(k),_.has(f,k)&&(f[k]=!0))}function f(a){for(var b=_.without(_.keys(a),"type"),c=b.length,d=[];c--;)d.push(!1);return _.object(b,d)}var g=[],h=f(d);e(d,d.type,g,h);var j=[];g.length&&j.push("definition is missing required attrs: "+g.join(", "));var k=_.map(_.reject(_.pairs(h),function(a){return a[1]}),function(a){return a[0]});if(k.length&&j.push("definition has unknown attrs: "+k.join(", ")),j.length)throw j}function m(a,b,c,e,f){var g=[];if(d(i,c.type,"check_logic",a,c,e,f,g),g.length)throw g}function n(a,b){return e.accessor(f,a.reduce)(a.group(b[a.dimension]))}function o(a,b,c,e){var g={};return d(i,b.type,"create",h,g,a,f,b,c,e,r),_.has(b,"more")&&b.more(g.chart),g.chart}function p(a,b,c){var d=[];for(var e in h.dimensions){q=h.dimensions[e];try{a(h,e,q)}catch(f){d.push({type:"dimension",name:e,errors:f})}}_.has(h,"groups")||(h.groups={});for(var g in h.groups){q=h.groups[g];try{b(h,g,q,h.dimensions)}catch(f){d.push({type:"group",name:g,errors:f})}}for(var i in h.charts){q=h.charts[i];try{c(h,i,q,h.dimensions,h.groups)}catch(f){d.push({type:"chart",name:i,errors:f})}}return d}i=i||e.dc_chart_program;var q,r=[];for(var s in h.charts){if(q=h.charts[s],!(q.type in i))throw'unknown chart type "'+q.type+'"';if(!i[q.type].supported)throw'unsupported chart type "'+q.type+'"';if(!i[q.type].concrete)throw"can't create abstract chart type \""+q.type+'"'}if(e.default_definition(h),r=p(e.default_dimension,e.default_group,j),r.length)throw r;if(r=p(e.infer_dimension,e.infer_group,k),r.length)throw r;if(r=p(e.check_dimension_attrs,e.check_group_attrs,l),r.length)throw r;if(r=p(e.check_dimension_logic,e.check_group_logic,m),r.length)throw r;console.log("dcplot charts definition:"),console.log(h);var t={},u={},v={},w=b(f.records());for(var x in h.dimensions)q=h.dimensions[x],t[x]=w.dimension(e.accessor(f,q));for(var y in h.groups)q=h.groups[y],u[y]=n(q,t);for(s in h.charts)q=h.charts[s],v[s]=o(g,q,t,u);return a.renderAll(g),{dataframe:f,crossfilter:w,dimensions:t,groups:u,charts:v}}e.version="0.4.0";var f=a.utils.printSingleValue;return a.utils.printSingleValue=function(a){return"number"==typeof a?a%1===0?a:a>1e4||-1e4>a?Math.round(a):a.toPrecision(4):f(a)},e.format_error=function(a){var b;_.isArray(a)?(b=$("<table/>"),$.each(a,function(c){var d=a[c],e=$("<td/>");_.isString(d.errors)?e.text(d.errors):_.isArray(d.errors)?$.each(d.errors,function(a){e.append($("<p/>").text(d.errors[a]))}):e.text(d.errors.message.toString());var f=d.name.replace(/_\d*_\d*$/,"");b.append($("<tr valign=top/>").append($("<td/>").text(d.type)).append($("<td/>").text(f)).append(e))})):b=$("<p/>").text(a.toString());var c=$("<div/>").append($("<p/>").text("dcplot errors!")).append(b);return c},e.mhas=function(a){for(var b=1;b<arguments.length;++b){if(!_.has(a,arguments[b])||void 0===a[arguments[b]])return!1;a=a[arguments[b]]}return!0},e.looks_ordinal=function(a,b,c){return _.has(b,c)&&_.isString(e.accessor(a,b[c])(0))},e.accessor=function(a,b){function c(a){return function(){return a}}if(_.isFunction(b))return b;if(_.isString(b))return a.has(b)?a.access(b):c(b);if(_.isObject(b)){if("fun"in b&&"arg"in b){var d=b.fun,f=b.arg,g=e.accessor(a,f);return d(g)}return c(b)}if(_.isNumber(b))return c(b);throw"illegal accessor "+b.toString()},e.get_levels=function(a,b,c){var d=null;return _.isFunction(c)?d=c.attrs.r_attributes.levels:_.has(b,c)&&e.mhas(e.accessor(a,b[c]),"attrs","r_attributes","levels")&&(d=e.accessor(a,b[c]).attrs.r_attributes.levels),d},e.find_unused=function(a,b){if(!a[b])return b;for(var c=1;a[b+c];)++c;return b+c},e.group={identity:function(a){return a.group()},bin:function(a){var b=function(b){return b.group(function(b){return Math.floor(b/a)*a})};return b.binwidth=a,b}},e.reduce={count:function(a){return a.reduceCount()},countFilter:function(a,b){return e.reduce.sum(function(c){return a(c)===b?1:0})},filter:function(a,b,c){function d(a){return function(d){return b(d)===c?a(d):0}}return{arg:a.arg,fun:function(b){return a.fun(d(b))}}},sum:function(a,b){return{arg:a,fun:function(a){return void 0===b?function(b){return b.reduceSum(function(b){return a(b)})}:function(c){return c.reduce(function(c,d){return c.sum+=a(d)*b(d),c},function(c,d){return c.sum-=a(d)*b(d),c},function(a,b){return{sum:0,valueOf:function(){return this.sum}}})}}}},any:function(a){return{arg:a,fun:function(a){return function(b){return b.reduce(function(b,c){return a(c)},function(a,b){return a},function(a,b){return 0})}}}},avg:function(a,b){return{arg:a,fun:function(a){return void 0===b?function(b){return b.reduce(function(b,c){return++b.count,b.sum+=a(c),b.avg=b.sum/b.count,b},function(b,c){return--b.count,b.sum-=a(c),b.avg=b.count?b.sum/b.count:0,b},function(a,b){return{count:0,sum:0,avg:0,valueOf:function(){return this.avg}}})}:function(c){return c.reduce(function(c,d){return c.count+=b(d),c.sum+=a(d)*b(d),c.avg=c.sum/c.count,c},function(c,d){return c.count-=b(d),c.sum-=a(d)*b(d),c.avg=c.count?c.sum/c.count:0,c},function(a,b){return{count:0,sum:0,avg:0,valueOf:function(){return this.avg}}})}}}},value:function(a){return function(b,c){return c[a]}}},e.default_definition=function(a){a.defreduce||(a.defreduce=e.reduce.count)},e.default_dimension=function(a,b,c){},e.default_group=function(a,b,c,d){var f=[];if(_.has(c,"group")||(c.group=e.group.identity),_.has(c,"reduce")||(c.reduce=a.defreduce),f.length)throw f},e.infer_dimension=function(a,b,c){},e.infer_group=function(a,b,c,d){},e.check_dimension_attrs=function(a,b,c){},e.check_group_attrs=function(a,b,c){var d=["dimension","group","reduce"],e=_.keys(c),f=_.difference(d,e),g=_.difference(e,d),h=[];if(f.length&&h.push("definition is missing required attrs: "+f.join(", ")),g.length&&h.push("definition has unknown attrs: "+g.join(", ")),h.length)throw h},e.check_dimension_logic=function(a,b,c){},e.check_group_logic=function(a,b,c,d){var e=[];if(_.has(d,c.dimension)||e.push('unknown dimension "'+c.dimension+'"'),e.length)throw e},e.key_value=function(a){return function(b){return a(b.key,b.value)}},e.dc_chart_program={base:{supported:!0,attributes:{div:{required:!0},title:{required:!1},dimension:{required:!0},group:{required:!0},ordering:{required:!1},width:{required:!0,"default":300},height:{required:!0,"default":300},"transition.duration":{required:!1},label:{required:!1},tips:{required:!1},more:{required:!1}},ctors:{pie:a.pieChart,bar:a.barChart,line:a.lineChart,bubble:a.bubbleChart,dataTable:a.dataTable},infer:function(a,b,c,d,f,g,h){if("div"in d||(d.div="#"+b),d.group)g[d.group]?d.dimension||(d.dimension=g[d.group].dimension):h.push('unknown group "'+d.group+'"');else if(d.dimension)if(f[d.dimension]){d.group=e.find_unused(g,d.dimension);var i=g[d.group]={};i.dimension=d.dimension,e.default_group(a,d.group,i,f),e.infer_group(a,d.group,i,f)}else h.push('unknown dimension "'+d.dimension+'"');if(!_.has(d,"ordering")){var j=e.get_levels(c,f,d.dimension);if(null!==j){var k=_.object(j,_.range(j.length));d.ordering=function(a){return k[a.key]}}}},check_logic:function(a,b,c,d,e){b.dimension&&b.dimension!==d[b.group].dimension&&e.push('group "'+b.group+'" dimension "'+d[b.group].dimension+'" does not match chart dimension "'+b.dimension+'"')},create:function(a,b,c,d,f,g,h,i){var j=this.ctors[f.type],k=j(f.div,c);k.dimension(g[f.dimension]).group(h[f.group]).width(f.width).height(f.height),_.has(f,"ordering")&&k.ordering(f.ordering),_.has(f,"transition.duration")&&k.transitionDuration(f["transition.duration"]),_.has(f,"label")&&(f.label?k.label(e.key_value(f.label)):k.renderLabel(!1)),_.has(f,"tips")&&(f.tips?k.title(e.key_value(f.tips)):k.renderTitle(!1)),b.chart=k}},color:{supported:!0,attributes:{color:{required:!1},"color.scale":{required:!1},"color.domain":{required:!1},"color.range":{required:!1}},infer:function(a,b,c,d,f,g,h){if(!d["color.scale"]){var i=e.get_levels(c,f,d.stack||d.dimension);d["color.scale"]=null!==i&&i.length>10?d3.scale.category20():d3.scale.category10()}d["color.domain"]||e.mhas(d,"color","attrs","r_attributes","levels")&&(d["color.domain"]=d.color.attrs.r_attributes.levels)},create:function(a,b,c,d,f,g,h,i){_.has(f,"color")&&b.chart.colorAccessor(e.key_value(e.accessor(d,f.color)));var j=f["color.scale"];_.has(f,"color.domain")&&j.domain(f["color.domain"]),_.has(f,"color.range")&&j.range(f["color.range"]),b.chart.colors(j)}},stackable:{supported:!0,attributes:{stack:{required:!1},"stack.levels":{required:!1}},infer:function(a,b,c,d,f,g,h){if(_.has(d,"stack")){_.has(d,"stack.levels")||(d["stack.levels"]=e.get_levels(c,f,d.stack));for(var i=d["stack.levels"],j=0;j<i.length;j++){var k=d.group+i[j],l=_.clone(g[d.group]);l.reduce===e.reduce.count?l.reduce=e.reduce.countFilter(d.stack,i[j]):l.reduce=e.reduce.filter(l.reduce,d.stack,d["stack.levels"][j]),g[k]=l}}},create:function(a,b,c,d,e,f,g,h){if(_.has(e,"stack")&&_.has(e,"stack.levels"))for(var i=0;i<e["stack.levels"].length;i++){var j=g[e.group+e["stack.levels"][i]];0===i?b.chart.group(j):b.chart.stack(j)}}},coordinateGrid:{supported:!0,parents:["base","color"],attributes:{margins:{required:!1},x:{required:!1},y:{required:!1},"x.ordinal":{required:!1},"x.scale":{required:!0},"x.domain":{required:!1},"x.units":{required:!1},"x.round":{required:!1},"x.elastic":{required:!1},"x.padding":{required:!1},"x.label":{required:!1},"y.scale":{required:!1},"y.domain":{required:!1},"y.elastic":{required:!1},"y.padding":{required:!1},"y.label":{required:!1},gridLines:{required:!1},brush:{required:!1}},infer:function(b,c,d,f,g,h,i){var j=e.get_levels(d,g,f.dimension);"x.ordinal"in f||(f["x.ordinal"]="x.units"in f&&f["x.units"]===a.units.ordinal||null!==j||e.looks_ordinal(d,g,f.dimension)),"x.scale"in f||!f["x.ordinal"]||(f["x.scale"]=d3.scale.ordinal()),"x.units"in f||!f["x.ordinal"]||(f["x.units"]=a.units.ordinal),"x.domain"in f||!j||(f["x.domain"]=j),"x.scale"in f||(f["x.scale"]=j?d3.scale.ordinal():d3.scale.linear()),"y.scale"in f||(f["y.scale"]=d3.scale.linear()),"x.domain"in f||"x.elastic"in f||(f["x.elastic"]=!0),"y.domain"in f||"y.elastic"in f||(f["y.elastic"]=!0)},check_logic:function(a,b,c,d,e){if(!(b["x.elastic"]||"x.domain"in b))throw"need x.domain unless x.elastic";if(!(b["y.elastic"]||"y.domain"in b))throw"need y.domain unless y.elastic"},create:function(a,b,c,d,f,g,h,i){_.has(f,"margins")?b.chart.margins(f.margins):b.chart.margins({top:10,right:50,bottom:30,left:60}),_.has(f,"x")&&b.chart.keyAccessor(e.key_value(e.accessor(d,f.x))),_.has(f,"y")&&b.chart.valueAccessor(e.key_value(e.accessor(d,f.y)));var j=f["x.scale"];if(_.has(f,"x.domain")&&j.domain(f["x.domain"]),b.chart.x(j).xUnits(f["x.units"]),_.has(f,"x.round")&&b.chart.round(f["x.round"]),_.has(f,"x.elastic")&&b.chart.elasticX(f["x.elastic"]),_.has(f,"x.padding")&&b.chart.xAxisPadding(f["x.padding"]),_.has(f,"x.label")&&b.chart.xAxisLabel(f["x.label"]),_.has(f,"y.scale")){var k=f["y.scale"];_.has(f,"y.domain")&&k.domain(f["y.domain"]),b.chart.y(k)}if(_.has(f,"y.elastic")&&b.chart.elasticY(f["y.elastic"]),_.has(f,"y.padding")&&b.chart.yAxisPadding(f["y.padding"]),_.has(f,"y.label")&&b.chart.yAxisLabel(f["y.label"]),_.has(f,"gridLines")){var l=f.gridLines;"horizontal"in l&&b.chart.renderVerticalGridLines(l.horizontal),"vertical"in l&&b.chart.renderVerticalGridLines(l.vertical)}_.has(f,"brush")&&b.chart.brushOn(f.brush)}},pie:{supported:!0,concrete:!0,parents:["base","color"],attributes:{radius:{required:!1},innerRadius:{required:!1},wedge:{required:!1},size:{required:!1}},create:function(a,b,c,d,f,g,h,i){_.has(f,"wedge")&&b.chart.keyAccessor(e.key_value(f.wedge)),_.has(f,"size")&&b.chart.keyAccessor(e.key_value(f.size)),_.has(f,"radius")&&b.chart.radius(f.radius),_.has(f,"innerRadius")&&b.chart.innerRadius(f.innerRadius)}},row:{supported:!1,parents:["base","color"]},bar:{supported:!0,concrete:!0,parents:["coordinateGrid","stackable"],attributes:{width:{"default":700},height:{"default":250},centerBar:{required:!1},gap:{required:!1},"color.x":{"default":!0},"x.units":{required:!0}},one_stack:function(a){return!_.has(a,"stack.levels")||_.has(a,"stack.levels")&&1===a["stack.levels"].length},infer:function(b,c,d,f,g,h,i){if(!("x.units"in f)&&f.group){var j=h[f.group];e.mhas(j,"group","binwidth")&&(f["x.units"]=a.units.fp.precision(j.group.binwidth))}if(!_.has(f,"color.domain")){var k;this.one_stack(f)?f["color.x"]&&(k=e.get_levels(d,g,f.dimension),k&&(f["color.domain"]=k)):(k=e.get_levels(d,g,f.stack),k&&(f["color.domain"]=k))}},create:function(b,c,d,e,f,g,h,i){_.has(f,"centerBar")&&c.chart.centerBar(f.centerBar),_.has(f,"gap")&&c.chart.gap(f.gap),_.has(f,"x.ordinal")&&f["x.ordinal"]&&f["color.x"]&&this.one_stack(f)?c.chart.renderlet(function(b){b.selectAll("rect.bar").style("fill",function(c,d){return d3.select(this).classed(a.constants.DESELECTED_CLASS)?null:b.colors()(c.x)})}):this.one_stack(f)||c.chart.renderlet(function(b){b.selectAll("g."+a.constants.STACK_CLASS).each(function(c,d){var e=f["stack.levels"][d];d3.select(this).selectAll("rect.bar").style("fill",function(c,d){return d3.select(this).classed(a.constants.DESELECTED_CLASS)?null:b.colors()(e)}).select("title").text(function(a,b){return e+", "+d3.select(this).text()})})})}},line:{supported:!0,concrete:!0,parents:["coordinateGrid","stackable"],attributes:{width:{"default":800},height:{"default":250},area:{required:!1},dotRadius:{required:!1}},create:function(a,b,c,d,e,f,g,h){_.has(e,"area")&&b.chart.renderArea(e.area),_.has(e,"dotRadius")&&b.chart.dotRadius(e.dotRadius)}},composite:{parents:["coordinateGrid"],supported:!1},abstractBubble:{supported:!0,parents:["color"],attributes:{r:{"default":2},"r.scale":{required:!1},"r.domain":{required:!1},"r.min":{required:!1}},create:function(a,b,c,d,e,f,g,h){_.has(e,"r.min")&&b.chart.minRadius(e["r.min"])}},bubble:{supported:!0,concrete:!0,parents:["coordinateGrid","abstractBubble"],attributes:{width:{"default":400},label:{"default":null},color:{"default":0},"r.elastic":{required:!1}},create:function(a,b,c,d,f,g,h,i){if(_.has(f,"r")&&b.chart.radiusValueAccessor(e.key_value(e.accessor(d,f.r))),_.has(f,"r.scale")||_.has(f,"r.domain")){var j=f["r.scale"]||d3.scale.linear();j.domain(f["r.domain"]||[0,100]),b.chart.r(j)}}},bubbleOverlay:{supported:!1,parents:["base","abstractBubble"]},geoCloropleth:{supported:!1},dataCount:{supported:!1},dataTable:{supported:!0,concrete:!0,parents:["base"],attributes:{columns:{required:!0},size:{required:!1},sortBy:{required:!1}},infer:function(a,b,c,d,e,f,g){var h=_.find(d.columns,function(a){return!c.has(a)});if(h)throw h+" not a valid column!"},create:function(a,b,c,d,f,g,h,i){b.chart.group(e.accessor(d,f.dimension)),b.chart.columns(f.columns.map(e.accessor.bind(null,d))),b.chart.size(f.size||d.records().length),_.has(f,"sortBy")&&b.chart.sortBy(e.accessor(d,f.sortBy))}}},e.dc=a,e.crossfilter=b,e}if("function"==typeof define&&define.amd)define(["dc","crossfilter"],a);else if("object"==typeof module&&module.exports){var b=require("dc"),c=require("crossfilter");"function"!=typeof c&&(c=c.crossfilter),module.exports=a(b,c)}else this.dc=b(dc,crossfilter)}();
//# sourceMappingURL=dcplot.min.js.map