/*!
 *  dcplot.js 0.4.0
 *  http://att.github.io/dcplot.js/
 *  Copyright (c) 2012-2013 AT&T Intellectual Property
 *
 *  Permission is hereby granted, free of charge, to any person obtaining a copy
 *  of this software and associated documentation files (the "Software"), to deal
 *  in the Software without restriction, including without limitation the rights
 *  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 *  copies of the Software, and to permit persons to whom the Software is
 *  furnished to do so, subject to the following conditions:
 *
 *  The above copyright notice and this permission notice shall be included in
 *  all copies or substantial portions of the Software.
 *
 *  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 *  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 *  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 *  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 *  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 *  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 *  THE SOFTWARE.
 */

!function(){function a(a,b){"use strict";function c(a){return"supported"===a||"concrete"===a||"parents"===a}function d(a,b,c){if(!(b in a))throw"unknown chart type "+defn.type;var e=a[b];if("parents"in e)for(var f=0;f<e.parents.length;++f)d(a,e.parents[f],c);c[b]()}function e(g,h,i){function j(a){for(var b=1;b<arguments.length;++b){if(!_.has(a,arguments[b])||void 0===a[arguments[b]])return!1;a=a[arguments[b]]}return!0}function k(a){i.defreduce||(i.defreduce=e.reduce.count)}function l(a,b){}function m(a,b,c){var d=[];if(_.has(b,"group")||(b.group=e.group.identity),_.has(b,"reduce")||(b.reduce=i.defreduce),d.length)throw d}function n(a,b,d,e){function g(a,b){var d=f[b];if(!d.supported)throw"chart type "+b+" not supported";for(var e in d)c(e)||_.has(d[e],"default")&&void 0===a[e]&&(a[e]=d[e]["default"]);if("parents"in d)for(var h=0;h<d.parents.length;++h)g(a,d.parents[h])}g(b,b.type)}function o(a){function b(a){return function(){return a}}if(_.isFunction(a))return a;if(_.isString(a))return g.has(a)?g.access(a):b(a);if(_.isObject(a)){if("fun"in a&&"arg"in a){var c=a.fun,d=a.arg,e=o(d);return c(e)}return b(a)}if(_.isNumber(a))return b(a);throw"illegal accessor "+a.toString()}function p(a){return!_.has(a,"stack.levels")||_.has(a,"stack.levels")&&1===a["stack.levels"].length}function q(a,b){}function r(a,b,c){}function s(b,c,h,i){function k(a,b){if(!a[b])return b;for(var c=1;a[b+c];)++c;return b+c}function l(a){var b=null;return _.isFunction(a)?b=a.attrs.r_attributes.levels:_.has(h,a)&&j(o(h[a]),"attrs","r_attributes","levels")&&(b=o(h[a]).attrs.r_attributes.levels),b}function n(a){return _.has(h,a)&&_.isString(o(h[a])(0))}var q=[],s={base:function(){if("div"in c||(c.div="#"+b),c.group)i[c.group]?c.dimension||(c.dimension=i[c.group].dimension):q.push('unknown group "'+c.group+'"');else if(c.dimension)if(h[c.dimension]){c.group=k(i,c.dimension);var a=i[c.group]={};a.dimension=c.dimension,m(c.group,a,h),r(c.group,a,h)}else q.push('unknown dimension "'+c.dimension+'"');if(!_.has(c,"ordering")){var d=l(c.dimension);if(null!==d){var e=_.object(d,_.range(d.length));c.ordering=function(a){return e[a.key]}}}},color:function(){if(!c["color.scale"]){var b=l(c.stack||c.dimension);c["color.scale"]=null!==b&&b.length>10?a.scale.category20():a.scale.category10()}c["color.domain"]||j(c,"color","attrs","r_attributes","levels")&&(c["color.domain"]=c.color.attrs.r_attributes.levels)},stackable:function(){if(_.has(c,"stack")){_.has(c,"stack.levels")||(c["stack.levels"]=l(c.stack));for(var a=(c["stack.levels"],0);a<c["stack.levels"].length;a++){var b=c.group+c["stack.levels"][a],d=_.clone(i[c.group]);d.reduce===e.reduce.count?d.reduce=e.reduce.countFilter(c.stack,c["stack.levels"][a]):d.reduce=e.reduce.filter(d.reduce,c.stack,c["stack.levels"][a]),i[b]=d}}},coordinateGrid:function(){var b=l(c.dimension);"x.ordinal"in c||(c["x.ordinal"]="x.units"in c&&c["x.units"]===dc.units.ordinal||null!==b||n(c.dimension)),"x.scale"in c||!c["x.ordinal"]||(c["x.scale"]=a.scale.ordinal()),"x.units"in c||!c["x.ordinal"]||(c["x.units"]=dc.units.ordinal),"x.domain"in c||!b||(c["x.domain"]=b),"x.scale"in c||(c["x.scale"]=b?a.scale.ordinal():a.scale.linear()),"y.scale"in c||(c["y.scale"]=a.scale.linear()),"x.domain"in c||"x.elastic"in c||(c["x.elastic"]=!0),"y.domain"in c||"y.elastic"in c||(c["y.elastic"]=!0)},pie:function(){},bar:function(){if(!("x.units"in c)&&c.group){var a=i[c.group];j(a,"group","binwidth")&&(c["x.units"]=dc.units.fp.precision(a.group.binwidth))}if(!_.has(c,"color.domain")){var b;p(c)?c["color.x"]&&(b=l(c.dimension),b&&(c["color.domain"]=b)):(b=l(c.stack),b&&(c["color.domain"]=b))}},line:function(){},abstractBubble:function(){},bubble:function(){},dataTable:function(){var a=_.find(c.columns,function(a){return!g.has(a)});if(a)throw a+" not a valid column!"}};if(d(f,c.type,s),q.length)throw q}function t(a,b){}function u(a,b){var c=["dimension","group","reduce"],d=_.keys(b),e=_.difference(c,d),f=_.difference(d,c),g=[];if(e.length&&g.push("definition is missing required attrs: "+e.join(", ")),f.length&&g.push("definition has unknown attrs: "+f.join(", ")),g.length)throw g}function v(a,b){function d(a,b,e,g){var h=f[b];if(!h.supported)throw'type "'+b+'" not supported';if("parents"in h)for(var i=0;i<h.parents.length;++i)d(a,h.parents[i],e,g);for(var j in h)c(j)||(h[j].required&&void 0===a[j]&&e.push(j),_.has(g,j)&&(g[j]=!0))}function e(a){for(var b=_.without(_.keys(a),"type"),c=b.length,d=[];c--;)d.push(!1);return _.object(b,d)}var g=[],h=e(b);d(b,b.type,g,h);var i=[];g.length&&i.push("definition is missing required attrs: "+g.join(", "));var j=_.map(_.reject(_.pairs(h),function(a){return a[1]}),function(a){return a[0]});if(j.length&&i.push("definition has unknown attrs: "+j.join(", ")),i.length)throw i}function w(a,b){}function x(a,b,c){var d=[];if(_.has(c,b.dimension)||d.push('unknown dimension "'+b.dimension+'"'),d.length)throw d}function y(a,b,c,e){var g=[],h={base:function(){b.dimension&&b.dimension!==e[b.group].dimension&&g.push('group "'+b.group+'" dimension "'+e[b.group].dimension+'" does not match chart dimension "'+b.dimension+'"')},color:function(){},stackable:function(){},coordinateGrid:function(){if(!(b["x.elastic"]||"x.domain"in b))throw"need x.domain unless x.elastic";if(!(b["y.elastic"]||"y.domain"in b))throw"need y.domain unless y.elastic"},pie:function(){},bar:function(){},line:function(){},abstractBubble:function(){},bubble:function(){},dataTable:function(){}};if(d(f,b.type,h),g.length)throw g}function z(a,b){return o(a.reduce)(a.group(b[a.dimension]))}function A(b,c,e,h){function i(a){return function(b){return a(b.key,b.value)}}var j,k,l={base:function(){k=j(c.div,b),k.dimension(e[c.dimension]).group(h[c.group]).width(c.width).height(c.height),_.has(c,"ordering")&&k.ordering(c.ordering),_.has(c,"transition.duration")&&k.transitionDuration(c["transition.duration"]),_.has(c,"label")&&(c.label?k.label(i(c.label)):k.renderLabel(!1)),_.has(c,"tips")&&(c.tips?k.title(i(c.tips)):k.renderTitle(!1))},color:function(){_.has(c,"color")&&k.colorAccessor(i(o(c.color)));var a=c["color.scale"];_.has(c,"color.domain")&&a.domain(c["color.domain"]),_.has(c,"color.range")&&a.range(c["color.range"]),k.colors(a)},stackable:function(){if(_.has(c,"stack")&&_.has(c,"stack.levels"))for(var a=0;a<c["stack.levels"].length;a++){var b=h[c.group+c["stack.levels"][a]];0===a?k.group(b):k.stack(b)}},coordinateGrid:function(){_.has(c,"margins")?k.margins(c.margins):k.margins({top:10,right:50,bottom:30,left:60}),_.has(c,"x")&&k.keyAccessor(i(o(c.x))),_.has(c,"y")&&k.valueAccessor(i(o(c.y)));var a=c["x.scale"];if(_.has(c,"x.domain")&&a.domain(c["x.domain"]),k.x(a).xUnits(c["x.units"]),_.has(c,"x.round")&&k.round(c["x.round"]),_.has(c,"x.elastic")&&k.elasticX(c["x.elastic"]),_.has(c,"x.padding")&&k.xAxisPadding(c["x.padding"]),_.has(c,"x.label")&&k.xAxisLabel(c["x.label"]),_.has(c,"y.scale")){var b=c["y.scale"];_.has(c,"y.domain")&&b.domain(c["y.domain"]),k.y(b)}if(_.has(c,"y.elastic")&&k.elasticY(c["y.elastic"]),_.has(c,"y.padding")&&k.yAxisPadding(c["y.padding"]),_.has(c,"y.label")&&k.yAxisLabel(c["y.label"]),_.has(c,"gridLines")){var d=c.gridLines;"horizontal"in d&&k.renderVerticalGridLines(d.horizontal),"vertical"in d&&k.renderVerticalGridLines(d.vertical)}_.has(c,"brush")&&k.brushOn(c.brush)},pie:function(){_.has(c,"wedge")&&k.keyAccessor(i(c.wedge)),_.has(c,"size")&&k.keyAccessor(i(c.size)),_.has(c,"radius")&&k.radius(c.radius),_.has(c,"innerRadius")&&k.innerRadius(c.innerRadius)},bar:function(){_.has(c,"centerBar")&&k.centerBar(c.centerBar),_.has(c,"gap")&&k.gap(c.gap),_.has(c,"x.ordinal")&&c["x.ordinal"]&&c["color.x"]&&p(c)?k.renderlet(function(b){b.selectAll("rect.bar").style("fill",function(c,d){return a.select(this).classed(dc.constants.DESELECTED_CLASS)?null:b.colors()(c.x)})}):p(c)||k.renderlet(function(b){b.selectAll("g."+dc.constants.STACK_CLASS).each(function(d,e){var f=c["stack.levels"][e];a.select(this).selectAll("rect.bar").style("fill",function(c,d){return a.select(this).classed(dc.constants.DESELECTED_CLASS)?null:b.colors()(f)}).select("title").text(function(b,c){return f+", "+a.select(this).text()})})})},line:function(){_.has(c,"area")&&k.renderArea(c.area),_.has(c,"dotRadius")&&k.dotRadius(c.dotRadius)},abstractBubble:function(){_.has(c,"r.min")&&k.minRadius(c["r.min"])},bubble:function(){if(_.has(c,"r")&&k.radiusValueAccessor(i(o(c.r))),_.has(c,"r.scale")||_.has(c,"r.domain")){var b=c["r.scale"]||a.scale.linear();b.domain(c["r.domain"]||[0,100]),k.r(b)}},dataTable:function(){k.group(o(c.dimension)),k.columns(c.columns.map(o)),k.size(c.size||g.records().length),_.has(c,"sortBy")&&k.sortBy(o(c.sortBy))}};return j={pie:dc.pieChart,bar:dc.barChart,line:dc.lineChart,bubble:dc.bubbleChart,dataTable:dc.dataTable}[c.type],d(f,c.type,l),_.has(c,"more")&&c.more(k),k}function B(a,b,c){var d=[];for(var e in i.dimensions){C=i.dimensions[e];try{a(e,C)}catch(f){d.push({type:"dimension",name:e,errors:f})}}_.has(i,"groups")||(i.groups={});for(var g in i.groups){C=i.groups[g];try{b(g,C,i.dimensions)}catch(f){d.push({type:"group",name:g,errors:f})}}for(var h in i.charts){C=i.charts[h];try{c(h,C,i.dimensions,i.groups)}catch(f){d.push({type:"chart",name:h,errors:f})}}return d}var C,D=[];for(var E in i.charts){if(C=i.charts[E],!(C.type in f))throw'unknown chart type "'+C.type+'"';if(!f[C.type].supported)throw'unsupported chart type "'+C.type+'"';if(!f[C.type].concrete)throw"can't create abstract chart type \""+C.type+'"'}if(k(i),D=B(l,m,n),D.length)throw D;if(D=B(q,r,s),D.length)throw D;if(D=B(t,u,v),D.length)throw D;if(D=B(w,x,y),D.length)throw D;console.log("dcplot charts definition:"),console.log(i);var F={},G={},H={},I=b(g.records());for(var J in i.dimensions)C=i.dimensions[J],F[J]=I.dimension(o(C));for(var K in i.groups)C=i.groups[K],G[K]=z(C,F);for(E in i.charts)C=i.charts[E],H[E]=A(h,C,F,G);return dc.renderAll(h),{dataframe:g,crossfilter:I,dimensions:F,groups:G,charts:H}}var e={version:"0.4.0"};e.group={identity:function(a){return a.group()},bin:function(a){var b=function(b){return b.group(function(b){return Math.floor(b/a)*a})};return b.binwidth=a,b}},e.reduce={count:function(a){return a.reduceCount()},countFilter:function(a,b){return e.reduce.sum(function(c){return a(c)===b?1:0})},filter:function(a,b,c){function d(a){return function(d){return b(d)===c?a(d):0}}return{arg:a.arg,fun:function(b){return a.fun(d(b))}}},sum:function(a,b){return{arg:a,fun:function(a){return void 0===b?function(b){return b.reduceSum(function(b){return a(b)})}:function(c){return c.reduce(function(c,d){return c.sum+=a(d)*b(d),c},function(c,d){return c.sum-=a(d)*b(d),c},function(a,b){return{sum:0,valueOf:function(){return this.sum}}})}}}},any:function(a){return{arg:a,fun:function(a){return function(b){return b.reduce(function(b,c){return a(c)},function(a,b){return a},function(a,b){return 0})}}}},avg:function(a,b){return{arg:a,fun:function(a){return void 0===b?function(b){return b.reduce(function(b,c){return++b.count,b.sum+=a(c),b.avg=b.sum/b.count,b},function(b,c){return--b.count,b.sum-=a(c),b.avg=b.count?b.sum/b.count:0,b},function(a,b){return{count:0,sum:0,avg:0,valueOf:function(){return this.avg}}})}:function(c){return c.reduce(function(c,d){return c.count+=b(d),c.sum+=a(d)*b(d),c.avg=c.sum/c.count,c},function(c,d){return c.count-=b(d),c.sum-=a(d)*b(d),c.avg=c.count?c.sum/c.count:0,c},function(a,b){return{count:0,sum:0,avg:0,valueOf:function(){return this.avg}}})}}}},value:function(a){return function(b,c){return c[a]}}};var f={base:{supported:!0,div:{required:!0},title:{required:!1},dimension:{required:!0},group:{required:!0},ordering:{required:!1},width:{required:!0,"default":300},height:{required:!0,"default":300},"transition.duration":{required:!1},label:{required:!1},tips:{required:!1},more:{required:!1}},color:{supported:!0,color:{required:!1},"color.scale":{required:!1},"color.domain":{required:!1},"color.range":{required:!1}},stackable:{supported:!0,stack:{required:!1},"stack.levels":{required:!1}},coordinateGrid:{supported:!0,parents:["base","color"],margins:{required:!1},x:{required:!1},y:{required:!1},"x.ordinal":{required:!1},"x.scale":{required:!0},"x.domain":{required:!1},"x.units":{required:!1},"x.round":{required:!1},"x.elastic":{required:!1},"x.padding":{required:!1},"x.label":{required:!1},"y.scale":{required:!1},"y.domain":{required:!1},"y.elastic":{required:!1},"y.padding":{required:!1},"y.label":{required:!1},gridLines:{required:!1},brush:{required:!1}},pie:{supported:!0,concrete:!0,parents:["base","color"],radius:{required:!1},innerRadius:{required:!1},wedge:{required:!1},size:{required:!1}},row:{supported:!1,parents:["base","color"]},bar:{supported:!0,concrete:!0,parents:["coordinateGrid","stackable"],width:{"default":700},height:{"default":250},centerBar:{required:!1},gap:{required:!1},"color.x":{"default":!0},"x.units":{required:!0}},line:{supported:!0,concrete:!0,parents:["coordinateGrid","stackable"],width:{"default":800},height:{"default":250},area:{required:!1},dotRadius:{required:!1}},composite:{parents:["coordinateGrid"],supported:!1},abstractBubble:{supported:!0,parents:["color"],r:{"default":2},"r.scale":{required:!1},"r.domain":{required:!1},"r.min":{required:!1}},bubble:{concrete:!0,parents:["coordinateGrid","abstractBubble"],width:{"default":400},label:{"default":null},color:{"default":0},supported:!0,"r.elastic":{required:!1}},bubbleOverlay:{supported:!1,parents:["base","abstractBubble"]},geoCloropleth:{supported:!1},dataCount:{supported:!1},dataTable:{supported:!0,concrete:!0,parents:["base"],columns:{required:!0},size:{required:!1},sortBy:{required:!1}}},g=dc.utils.printSingleValue;return dc.utils.printSingleValue=function(a){return"number"==typeof a?a%1===0?a:a>1e4||-1e4>a?Math.round(a):a.toPrecision(4):g(a)},e.format_error=function(a){var b;_.isArray(a)?(b=$("<table/>"),$.each(a,function(c){var d=a[c],e=$("<td/>");_.isString(d.errors)?e.text(d.errors):_.isArray(d.errors)?$.each(d.errors,function(a){e.append($("<p/>").text(d.errors[a]))}):e.text(d.errors.message.toString());var f=d.name.replace(/_\d*_\d*$/,"");b.append($("<tr valign=top/>").append($("<td/>").text(d.type)).append($("<td/>").text(f)).append(e))})):b=$("<p/>").text(a.toString());var c=$("<div/>").append($("<p/>").text("dcplot errors!")).append(b);return c},e.dc=dc,e.crossfilter=b,e}if("function"==typeof define&&define.amd)define(["dc","crossfilter"],a);else if("object"==typeof module&&module.exports){var b=require("dc"),c=require("crossfilter");"function"!=typeof c&&(c=c.crossfilter),module.exports=a(b,c)}else this.dc=b(dc,crossfilter)}();
//# sourceMappingURL=dcplot.min.js.map